-- =====================================================
-- MIGRATION: Fix invalid wallet addresses
-- Date: 2025-09-16
-- =====================================================

-- Fix addresses that are too short or invalid
UPDATE users SET wallet_address = 'GABC1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789AB' WHERE wallet_address = 'GABC1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ';
UPDATE users SET wallet_address = 'GDEF9876543210ZYXWVUTSRQPONMLKJIHGFEDCBA0123456789' WHERE wallet_address = 'GDEF9876543210ZYXWVUTSRQPONMLKJIHGFEDCBA';
UPDATE users SET wallet_address = 'GHIJ1111222233334444555566667777888899990000111122' WHERE wallet_address = 'GHIJ111122223333444455556666777788889999';
UPDATE users SET wallet_address = 'GKLN5555666677778888999900001111222233334444555566' WHERE wallet_address = 'GKLN555566667777888899990000111122223333';
UPDATE users SET wallet_address = 'GMNO9999888877776666555544443333222211110000999988' WHERE wallet_address = 'GMNO999988887777666655554444333322221111';
UPDATE users SET wallet_address = 'GPQR4444555566667777888899990000111122223333444455' WHERE wallet_address = 'GPQR444455556666777788889999000011112222';
UPDATE users SET wallet_address = 'GSTU3333444455556666777788889999000011112222333344' WHERE wallet_address = 'GSTU333344445555666677778888999900001111';
UPDATE users SET wallet_address = 'GVWX2222333344445555666677778888999900001111222233' WHERE wallet_address = 'GVWX222233334444555566667777888899990000';
UPDATE users SET wallet_address = 'GYZA1111222233334444555566667777888899990000111122' WHERE wallet_address = 'GYZA111122223333444455556666777788889999';
UPDATE users SET wallet_address = 'GZAB0000111122223333444455556666777788889999000011' WHERE wallet_address = 'GZAB000011112222333344445555666677778888';

-- Fix any addresses that start with GTEST and are not 56 characters
UPDATE users SET wallet_address = 'GTEST' || UPPER(SUBSTRING(MD5(id::text), 1, 51))
WHERE wallet_address LIKE 'GTEST%' AND LENGTH(wallet_address) != 56;